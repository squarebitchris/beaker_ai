<div class="container mx-auto px-4 py-8 max-w-2xl">
  <h1 class="text-3xl font-bold mb-6"><%= @trial.business_name %> Assistant</h1>

  <% unless @trial.ready? %>
    <div id="assistant-status" class="bg-blue-50 border border-blue-200 rounded-lg p-6 mb-6">
      <div class="flex items-center space-x-3">
        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
        <div>
          <p class="font-semibold text-blue-900">Creating your AI assistant...</p>
          <p class="text-sm text-blue-700">This usually takes 10-20 seconds</p>
        </div>
      </div>
    </div>
  <% end %>

  <% if @trial.ready? %>
    <div class="bg-green-50 border border-green-200 rounded-lg p-6 mb-6">
      <p class="font-semibold text-green-900 mb-4">âœ“ Your assistant is ready!</p>
      
      <%= form_with url: call_trial_path(@trial), method: :post, local: true do |f| %>
        <div class="mb-4">
          <%= f.label :phone_number, "Phone Number to Call", class: "block text-sm font-medium mb-2" %>
          <%= f.text_field :phone_number,
              value: @trial.phone_e164,
              placeholder: "+15555551234",
              class: "w-full px-4 py-3 border rounded-lg",
              required: true %>
        </div>
        
        <p class="text-sm text-gray-600 mb-4">
          Calls remaining: <strong><%= @trial.calls_remaining %></strong> of <%= @trial.calls_limit %>
        </p>
        
        <%= f.submit "Call Me Now", 
            class: "w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700",
            data: { turbo: false } %>
      <% end %>
    </div>
  <% end %>

  <script>
    // Simple polling for assistant readiness
    <% unless @trial.ready? %>
      const pollInterval = setInterval(async () => {
        try {
          const response = await fetch('<%= trial_path(@trial, ready: 1) %>');
          const data = await response.json();
          
          if (data.ready) {
            clearInterval(pollInterval);
            window.location.reload();
          }
        } catch (error) {
          console.error('Poll error:', error);
        }
      }, 3000); // Poll every 3 seconds
    <% end %>
  </script>
</div>
