# R1-E01-T012 - Design System Foundation

**Status:** ✅ Complete  
**Completed:** October 26, 2025  
**Points:** 3  

## Summary

Successfully implemented a shadcn-inspired design system with CSS variables and Tailwind CSS, adapted for Rails ViewComponents. The system supports light/dark themes with runtime switching and provides a foundation for all future UI development.

## Delivered

### 1. Design Token System
- **File:** `app/assets/stylesheets/tokens.css`
- HSL color space for alpha channel manipulation
- Semantic color tokens (primary, destructive, muted, etc.)
- Light and dark theme definitions
- Typography, border radius, and shadow tokens
- Tailwind utility class mappings

### 2. Theme Switching
- **File:** `app/javascript/controllers/theme_controller.js`
- Runtime theme switching with localStorage persistence
- System preference detection fallback
- No flash of wrong theme on page load
- Custom event emission for analytics

### 3. Core Components (4 Essential)

#### Button Component
- **Files:** `app/components/primitives/button_component.rb` + `.html.erb`
- **Variants:** default, destructive, outline, secondary, ghost, link
- **Sizes:** sm, default, lg, icon
- **Features:** Loading state with spinner, disabled state
- **Mobile:** 44px minimum touch target

#### Input Component
- **Files:** `app/components/primitives/input_component.rb` + `.html.erb`
- **Features:** Label, helper text, error states, required indicator
- **Accessibility:** ARIA labels, aria-invalid, aria-describedby
- **Mobile:** 44px minimum height

#### Card Component
- **Files:** `app/components/primitives/card_component.rb` + `.html.erb`
- **Slots:** header, title, description, footer
- **Usage:** Dashboard stats, forms, content containers

#### Toast Component
- **Files:** `app/components/primitives/toast_component.rb` + `.html.erb`
- **Variants:** default, success, error, warning
- **Features:** Auto-dismiss (5s), manual dismiss, icons
- **Controller:** `app/javascript/controllers/toast_controller.js`

### 4. Preview System
- **File:** `spec/components/previews/primitives_preview.rb`
- Preview templates for all components
- Custom preview layout with theme toggle
- Accessible at `http://localhost:3000/rails/view_components`

### 5. Tests
- **Files:** `spec/components/primitives/*_component_spec.rb`
- Comprehensive specs for all components
- Variant testing, state testing, accessibility checks
- All specs passing ✅

### 6. Documentation
- **File:** `docs/DESIGN-SYSTEM.md`
- Complete design token reference
- Component usage examples
- Theme customization guide
- Accessibility guidelines
- Color palette reference

### 7. Layout Integration
- **File:** `app/views/layouts/application.html.erb`
- Theme controller attached to body
- Theme initialization script (prevents flash)
- Semantic color classes on notices/alerts

## Files Created (19 total)

**Stylesheets:**
- `app/assets/stylesheets/tokens.css`
- Updated `app/assets/stylesheets/application.tailwind.css`

**JavaScript Controllers:**
- `app/javascript/controllers/theme_controller.js`
- `app/javascript/controllers/toast_controller.js`

**Components (8 files):**
- `app/components/primitives/button_component.rb` + `.html.erb`
- `app/components/primitives/input_component.rb` + `.html.erb`
- `app/components/primitives/card_component.rb` + `.html.erb`
- `app/components/primitives/toast_component.rb` + `.html.erb`

**Previews (6 files):**
- `spec/components/previews/primitives_preview.rb`
- `spec/components/previews/primitives_preview/buttons.html.erb`
- `spec/components/previews/primitives_preview/button_loading.html.erb`
- `spec/components/previews/primitives_preview/inputs.html.erb`
- `spec/components/previews/primitives_preview/cards.html.erb`
- `spec/components/previews/primitives_preview/toasts.html.erb`

**Tests (4 files):**
- `spec/components/primitives/button_component_spec.rb`
- `spec/components/primitives/input_component_spec.rb`
- `spec/components/primitives/card_component_spec.rb`
- `spec/components/primitives/toast_component_spec.rb`

**Layouts:**
- `app/views/layouts/component_preview.html.erb`
- Updated `app/views/layouts/application.html.erb`

**Documentation:**
- `docs/DESIGN-SYSTEM.md`

## Technical Highlights

1. **HSL Color Space:** All colors use HSL for easy alpha channel manipulation (`bg-primary/50`)

2. **Tailwind v4 Compatible:** Works with the latest Tailwind CSS @layer syntax

3. **Zero Custom CSS:** 100% Tailwind utility classes in components

4. **Accessibility Built-in:** WCAG 2.1 AA contrast, keyboard navigation, screen reader support

5. **Theme Persistence:** User preference saved in localStorage, survives page reloads

6. **No Flash:** Theme applied before page render via inline script

7. **Mobile-First:** All components meet 44px touch target minimum

8. **Future-Proof:** Easy to add new themes, variants, and components on-demand

## Usage Examples

### Button
```erb
<%= render Primitives::ButtonComponent.new { "Click me" } %>
<%= render Primitives::ButtonComponent.new(variant: :destructive) { "Delete" } %>
<%= render Primitives::ButtonComponent.new(loading: true) %>
```

### Input
```erb
<%= render Primitives::InputComponent.new(
  name: "email",
  type: "email",
  label: "Email Address",
  error: @user.errors[:email].first
) %>
```

### Card
```erb
<%= render Primitives::CardComponent.new do |card| %>
  <% card.with_title { "Title" } %>
  <% card.with_description { "Description" } %>
  <p>Content</p>
<% end %>
```

### Toast
```erb
<%= render Primitives::ToastComponent.new(
  variant: :success,
  title: "Saved!",
  message: "Your changes have been saved"
) %>
```

## Next Steps (Phase 1)

The design system is now ready for Phase 1 trial flow tickets:
1. **R1-E02-T001** - Landing page will use Button, Input
2. **R1-E02-T003** - Trial builder will use Card, Input, Button
3. **R1-E02-T007** - Trial status page will use Card, loading Button

Additional components (AudioPlayer, Badge, etc.) will be created on-demand when Phase 2 tickets need them.

## Testing the System

### Local Development
1. Start Rails: `bin/dev`
2. Visit ViewComponent previews: `http://localhost:3000/rails/view_components`
3. Toggle theme with moon/sun icon in preview
4. Test all component variants

### Run Tests
```bash
bundle exec rspec spec/components/primitives/
```

All specs should pass ✅

## Success Criteria ✅

- [x] Tailwind config extended with brand colors + semantic palette
- [x] 4 ViewComponents created: Button, Input, Card, Toast
- [x] Each component has comprehensive specs
- [x] ViewComponent::Preview setup for visual QA
- [x] Components used in application layout (notices/alerts)
- [x] Mobile-friendly tested (44px min tap targets)
- [x] Focus rings visible for keyboard navigation
- [x] No custom CSS written (100% Tailwind utilities)
- [x] Theme switching works at runtime
- [x] Documentation complete

## References

- [shadcn/ui](https://ui.shadcn.com/) - Design inspiration
- [Tailwind CSS v4](https://tailwindcss.com/docs) - Utility framework
- [ViewComponent](https://viewcomponent.org/) - Component architecture
- [WCAG 2.1](https://www.w3.org/WAI/WCAG21/quickref/) - Accessibility standards

